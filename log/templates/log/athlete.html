{% extends 'log/base.html' %}
{% load staticfiles %}

{% block content %}
  <div>
    <div class="page_title" style="display:inline-block">
      <h2>{{ athlete_user.first_name }} {{ athlete_user.last_name}}</h2>
    </div>
  </div>
  <div id="page">

<div class="container-fluid">
  <div class="panel-group">
    <div class="panel panel-default">
      <div class="panel-heading">Mileage</div>
      <div class="panel-body">
            <div id= "mileage_options">
            <div class="graph_option btn" id="current_year_selector">Year</div>
            <div class="graph_option btn" id="current_month_selector">Month</div>
            <div class="graph_option btn" id="current_week_selector">Week</div>
            <div class="graph_option btn" id="range_selector">Range</div>
          </div>

              <!--Load the script with the actual mileage graph in it -->
              <script type="text/javascript">
                var show_range_graph_first = {{ show_range_first|safe }};

                {% if year_graph_data %}
                var year_graph_data = {{ year_graph_data|safe }}
                {% else %}
                var year_graph_data = null;
                {% endif %}

                {% if month_graph_data %}
                var month_graph_data = {{ month_graph_data|safe }}
                {% else %}
                var month_graph_data = null;
                {% endif %}

                {% if week_graph_data %}
                var week_graph_data = {{ week_graph_data|safe }}
                {% else %}
                var week_graph_data = null;
                {% endif %}

                {% if range_graph_data %}
                var range_graph_data = {{ range_graph_data|safe }}
                {% else %}
                var range_graph_data = null;
                {% endif %}
            </script>

              <script type="text/javascript" src="{% static 'log/js/mileage.js' %}"></script>

              <!--Div that will hold the bar chart-->
            <div id="year_mileage_graph" class="graph"></div>
            <div id="month_mileage_graph" style="width: 100%"></div>
            <div id="week_mileage_graph" style="width: 100%"></div>
            <div id="date_range_graph" style="width: 100%">
              <form action="/log/athlete/{{ user.id }}/" method='post'>
                {% csrf_token %}
                {{ form.errors }}
                {{ form }}
                <input type="submit" value="Show Mileage"/>
              </form>
            </div>
            <div id='run_legend'>
              <div class='legend' id='legend_normal'>Normal</div>
              <div class='legend' id='legend_interval'>Interval</div>
              <div class='legend' id='legend_cross'>Cross</div>
              <div class='legend' id='legend_event'>Event</div>
            </div>
            </div>
    </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">Workout History</div>
      <div class="panel-body">
        <h3>Workout History</h3>
        <table>
          <tr>
            <th><h4>Date</h4></th>
            <th><h4>Distance</h4></th>
            <th><h4>Pace</h4></th>
            <th><h4>Type</h4></th>
            {% if can_edit %}
              <th><h4>Actions</h4></th>
            {% endif %}

          </tr>
          {% for r in all_runs %}
            <!-- <a href="/log/athlete/activity_detail/{{ r.activity_id }}"> -->
            <tr class="clickable-row" data-href="/log/athlete/activity_detail/{{ r.activity_id }}">
              <td>
                {{ r.activity.date|date:"l" }} {{ r.activity.date }}
              </td>
              <td>
                {{ r.distance }}
              </td>
              <td>
                {% ifequal r.activity.act_type "IntervalRun" %}
                    -
                {% endifequal %}

                {% ifequal r.activity.act_type "Event" %}
                  {{ r.pace }}
                {% endifequal %}

                {% ifequal r.activity.act_type "NormalRun" %}
                  {{ r.pace }}
                {% endifequal %}

                {% ifequal r.activity.act_type "CrossTrain" %}
                    -
                {% endifequal %}
              </td>
              <td>
                {% ifequal r.activity.act_type "IntervalRun" %}
                  Interval Workout
                {% endifequal %}

                {% ifequal r.activity.act_type "Event" %}
                  Race
                {% endifequal %}

                {% ifequal r.activity.act_type "NormalRun" %}
                  Normal Run
                {% endifequal %}

                {% ifequal r.activity.act_type "CrossTrain" %}
                  Cross Train
                {% endifequal %}
              </td>
              {% if can_edit %}
                  <td><a href="/log/athlete/edit_activity/{{ r.activity_id }}">EDIT</a></td>
              {% endif %}
              </div>
            </tr>
          <!-- </a> -->
          {% endfor %}
        </table>
        </div>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading">Personal Records</div>
      <div class="panel-body">
      {% for pr in prs %}
        <div>
          <p>{{ pr.distance }} {{ pr.units }}:
          {{ pr.duration }}
          (at {{ pr.meet.location }} {{ pr.activity.date }})
          </p>
        </div>
      {% endfor %}

        </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  jQuery(document).ready(function($) {
      $(".clickable-row").click(function() {
          window.document.location = $(this).data("href");
      });
  });

  $(document).ready(function() {
    $('.clickable-row').bind("mouseover", function(){
        var color = $(this).css("background-color");
        $(this).css("background", "#dcc7aa");
        $(this).bind("mouseout", function(){
            $(this).css("background", color);
        })
    })

    $(".clickable-row").hover(function() {
            $(this).css({"cursor": "pointer"});
    });
 })
</script>
{% endblock %}
